<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">    
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>  
  <script src="tools.js"></script>
  <title>Matching Game</title>
</head>
<body>



<nav class="navbar navbar-dark bg-dark">
  <h1 class="navTitle text-center">Matching Game</h1>
</nav>

    
<div id="main" class="container-fluid row justify-content-center">
    <div class="col-lg-12 text-center" id="newGameField" style="display: none;">
        <button class="newGameButton col-lg-2" onclick="GameField()">New Game</button>
    </div>
    <div class="container-fluid row col-lg-2 col-sm-12"></div>
    <div class="container-fluid row col-lg-7 col-sm-12">
        <div class="board d-flex align-items-center justify-content-center">
            <table>
                <thead id="tableContent">
                    <tr>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card1" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card2" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card3" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card4" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    </tr>
                    <tr>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card5" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card6" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card7" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card8" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    </tr>
                    <tr>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card9" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card10" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card11" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card12" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    </tr>
                    <tr>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card13" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card14" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card15" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    <td><div class="maincontainer">
                                <div class="thecard" id="card16" onclick="play(this)">
                                    <div class="thefront"></div>
                                    <div class="theback"></div>
                                </div>
                    </div></td>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
        </br>
    <div class="container-fluid row col-lg-3 col-sm-12"></div>
</div>
    <div id="#overview">
    <div class="container-fluid row">
        <div class="col-lg-2"></div>
        
        <div class="col-lg-8">
            </br>
            <h1>Game Rules</h1>
            <p>
                This game is a browser-based card matching game that presents the player with cards arranged in a 4x4 grid.
                </br>
                </br>
                The back of each card is a common design shared by all cards. The front contains a distinctive symbol shared by one pair of cards in the deck, thus there are 8 unique symbols shared by 8 pairs of cards in the deck.
                </br>
                </br>
                The objective of the Matching Game is for the player to turn over pairs of matching cards across eight successive turns. In a turn if the player selects two cards whose symbols match those cards, along with those successfully matched in previous turns, will remain up. However, if the player chooses two cards with different symbols they will both be flipped over, obscuring their symbols.
                </br>
                </br>
                The game ends when all eight pairs of matching cards have been revealed. When this occurs a message should be displayed to let the user know they have won the game.
                </br>
                </br>
                A 'New Game' Button gives the player the means to reset the game board.
            </p>
        </div>
        <div class="col-lg-2"></div>
    </div>
    </div>


<div id="footer" class="container-fluid"></div>



<script>

var matches = 2;
var totalPics = 8;
var columns = Math.sqrt(matches*totalPics); 
var rows = columns;
if(columns % 2 == 0) {} else { // it calculates the right proportions of the field (4x4 or 8x4 or 8x5)
    var a = Math.ceil(columns)
    for(var i = (a*2); i > a-1; i--) {
        for(var j = Math.ceil(a/2); j < a; j++) {
            if((matches*totalPics)/i == j) {
                columns = i;
                rows = j; 
            }
        }
    }
}
var picOrder = [];
var resetElements = [];
var turn = 0;


//==========================================================================


startGame()
function startGame() {
    saveField("tableContent"); // saves the currently empty table and restores it later
    // creates a random array with the (number)names of the pics
    
    picOrder = [];    
    for(var k = 0; k < matches; k++) {
        for(var l = 1; l <= totalPics; l++) {
            picOrder.push(l)
        }
    }
    shuffleArray(picOrder)

    var m = 0;
    $(".theback").each(function() {
        $(this).attr("picnumber",picOrder[m]).attr("style", "background-image: url(images/" + picOrder[m++] + ".jpg");
    })
}


//==========================================================================

var openCards = 0;
var lastPic = []; 
var solvedPairs = 0;
var elementArray = [];


function play(field) {
    if($(field).hasClass("open")) {return}
    if($(field).hasClass("solved")) {return}
    if(openCards > 1) {return}
    
    var currentPic = parseInt($(field).children(".theback").attr("picnumber"));
    lastPic.push(currentPic)
    
    $(field).css('transform', 'rotatey(180deg)').addClass("open");
    openCards += 1;
    window.elementArray.push($(field))
    
    if(openCards > 1) {
        ++turn;
        //w(lastPic[0],lastPic[1])
        if(lastPic[0] == lastPic[1]) { 
            lastPic = [];
            openCards = 0;
            ++solvedPairs;
            $(field).addClass("solved").removeClass("open");
            $(elementArray[elementArray.length-2]).addClass("solved").removeClass("open");
        } else {
            setTimeout(function() {
                $(".open").css('transform', 'rotatey(0deg)').removeClass("open");
                lastPic = [];
                openCards = 0;
                sync(true);
            ;}, 3000);
        }
        if(solvedPairs == totalPics) {
            alert("You have won the game in " + turn + " turns!!!")
            newGame()
        }
    }
}

//==========================================================================

function newGame() {
    $("#newGameField").slideDown()
}

function GameField(){
    resetField("tableContent")  // restores the table skeleton
    $("#newGameField").slideUp()
    openCards = 0;
    turn = 0;
    lastPic = []; 
    solvedPairs = 0;
    startGame()
}




</script>




</body>
</html>
